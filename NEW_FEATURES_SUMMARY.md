# CARL New Features Implementation Summary

## Features to Add:

### 1. "Same Appliances" Function ✅
**Location:** After asking number of appliances
**Flow:**
```
CARL: How many appliances? (1-6)
You: 3
CARL: Are all 3 appliances identical?
      1) Yes - configure once, apply to all
      2) No - configure each separately
You: 1
CARL: Configure the appliance (will apply to all 3)...
```

### 2. Building Heating Appliance Category ✅
**Added to categories:**
```
6) Building Heating Appliance
   - CO2: 8.5%
   - Temperature: 380°F
   - Pressure: -0.08 to -0.03 in w.c.
```

### 3. Optimized Sizing vs User Select ✅
**Location:** Before asking for diameters
**Flow:**
```
CARL: Would you like CARL to optimize vent sizing?
      1) Yes - CARL will suggest optimal diameters
      2) No - I will specify diameters
You: 1
CARL: I'll suggest optimal sizes based on velocity targets.
      [Connector: suggests X"]
      [Manifold: suggests Y"]
```

### 4. Combustion Air Requirements ✅
**Calculation:**
```
Combustion Air CFM = Total Flue Gas Mass - Fuel Mass
At ambient temperature (not flue gas temp)

For Natural Gas:
- Fuel density: ~0.042 lb/ft³ at 60°F
- Fuel mass = MBH × 1000 BTU/hr × (1 lb fuel / ~21,500 BTU) / 60 min
- Combustion air mass = Flue gas mass - Fuel mass
- Combustion air CFM = Mass / ρ_ambient
```

### 5. Louver Sizing ✅
**Single Louver Method:**
```
Free area = Combustion Air CFM / 2000 fpm (max velocity)
Louver area = Free area / 0.75 (75% free area typical)
```

**Two Louver Method:**
```
Upper louver: Within 12" of ceiling
Lower louver: Within 12" of floor
Each louver free area = Combustion Air CFM / 2000 fpm
Total louver area (both) = 2 × (Free area / 0.75)
```

### 6. Printed Sizing Report ✅
**Format:**
```
================================================================================
CARL VENTING SYSTEM SIZING REPORT
================================================================================

PROJECT INFORMATION
- Date: [current date]
- Elevation: X ft (Barometric: Y.YY in Hg)
- Outside Temperature: XX°F

APPLIANCE CONFIGURATION
- Number of Appliances: X
- Total Input: XXXX MBH

Appliance #1:
- Category: [name]
- Input: XXX MBH
- CO2: X.X%
- Flue Gas Temp: XXX°F
- Fuel: [type]
- Outlet: X"

[repeat for each appliance]

CONNECTOR CONFIGURATION
- Diameter: X" (optimized / user-selected)
- Length: XX ft
- Height: XX ft
- Fittings:
  * 90° elbows: X
  * 45° elbows: X
  * 30° elbows: X
  * 90° Tees: X
  * 45° Lateral Tees: X

COMMON VENT CONFIGURATION
- Diameter: XX" (optimized / user-selected)
- Vertical Height: XX ft
- Horizontal Run: XX ft
- Total Length: XX ft
- Fittings:
  * 90° elbows: X
  * [etc]

VENTING ANALYSIS RESULTS

Worst Case Connector:
- Appliance: #X (XXX MBH)
- Draft: X.XXXX in w.c.
- Velocity: XXXX ft/min

Operating Scenarios:
- All Appliances: XXX CFM, XXXX ft/min, X.XXXX in w.c.
- All Minus One: XXX CFM, XXXX ft/min, X.XXXX in w.c.
- Single Largest: XXX CFM, XXXX ft/min, X.XXXX in w.c.
- Single Smallest: XXX CFM, XXXX ft/min, X.XXXX in w.c.

Total System (Connector + Manifold):
- Connector Draft: X.XXXX in w.c.
- Manifold Draft: X.XXXX in w.c.
- TOTAL AVAILABLE DRAFT: X.XXXX in w.c.
- Atmospheric Pressure: X.XXXX in w.c.

Category Compliance:
[compliance check results]

Seasonal Variation Estimate:
- Winter (0°F): ~X.XXXX in w.c.
- Design (XX°F): ~X.XXXX in w.c.
- Summer (95°F): ~X.XXXX in w.c.

COMBUSTION AIR REQUIREMENTS

Total Combustion Air Required: XXXX CFM at XX°F

Method 1: Single Louver
- Required Free Area: XX.X sq in
- Louver Size (with 75% free area): XX.X sq in
- Recommended: XX" × XX" louver

Method 2: Two Louver (High/Low)
- Upper Louver Free Area: XX.X sq in
- Lower Louver Free Area: XX.X sq in
- Each Louver Size: XX.X sq in
- Recommended: Two XX" × XX" louvers

US DRAFT CO. RECOMMENDATIONS
[product recommendations based on results]

DISCLAIMERS
- Calculations based on steady-state conditions
- Actual draft varies with weather, wind, and building pressure
- US Draft Co. draft controls REQUIRED for year-round reliability
- Verify all installations with local codes and manufacturer specs

Report generated by CARL v1.0 Beta
© 2025 US Draft by RM Manifold | 817-393-4029 | www.usdraft.com
================================================================================
```

## Implementation Notes:

1. **Same appliances:** Add after `num_appliances` question, before first appliance config
2. **Building heating:** Add as option 6 in category selection
3. **Optimize toggle:** Add before connector diameter question
4. **Combustion air:** Calculate after results, before displaying
5. **Louver sizing:** Calculate based on combustion air CFM
6. **Report:** Generate formatted text report, offer download

## File Changes Needed:

1. `enhanced_calculator.py` - Add building_heating category ✅ DONE
2. `streamlit_carl_chatbot.py` - Add all new conversation flows
3. Add combustion air calculation function
4. Add louver sizing function  
5. Add report generation function

Would you like me to proceed with implementing all of these in the chatbot?

